{% extends 'base.html' %}
{% load static %}

{% block css %}
    <link rel="stylesheet" href="{% static 'css/copyBuffer.css' %}">
{% endblock %}

{% block content %}
    <!-- Begin page content -->
    <div class="container">
        <div class="row">
            <div class="col text-center">
                <h1>{{ pagename }}</h1>
                <hr>
            </div>
        </div>

        <fieldset disabled>
            <div class="row disabled">
                <div class="col col-5">
                    –ù–∞–∑–≤–∞–Ω–∏–µ: <input type="text" value="{{ snippet.name }}" class="form-control">
                </div>
                <div class="col col-3">
                    –Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏—è: <input type="text" value="{{ snippet.lang }}" class="form-control">
                </div>
                <div class="col col-2">
                    –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:<input type="text" value="{{ snippet.creation_date|date:'d.m.Y H:i' }}"
                                         class="form-control">
                </div>
                <div class="col col-2">
                    –î–∞—Ç–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:<input type="text" value="{{ snippet.update_at|date:'d.m.Y H:i' }}"
                                               class="form-control">
                </div>
            </div>
            <hr>
            <div class="row">
                <div class="col">
                    <div class="p-2 h-100" style="border:1px solid #ced4da; border-radius:5px;">
                        <p>
                            Description:<input type="text" value="{{ snippet.description }}" class="form-control"
                                               style="height: calc(10vh + 10px)">
                        </p>
                    </div>
                </div>
                {# test block  TAG  Start #}
                <div class="col-md-3">
                    <h5>–¢–µ–≥–∏:</h5>
                    {% if tags %}
                        {% for tag in tags %}
                            <span class="badge bg-primary me-2 mb-1">{{ tag }}</span>
                        {% endfor %}
                    {% else %}
                        <p class="text-muted">–ü–æ–∫–∏ —â—î —Ç—É—Ç –Ω–µ–º–∞—î —Ç–µ–≥—ñ–≤ üòï</p>
                    {% endif %}
                </div>
                {# test block  TAG  Finish #}
            </div>
            <hr>
            <div class="row">
                <div class="col-11">
                    <div class="p-2 h-100" style="border:1px solid #ced4da; border-radius:5px;">
                        <p>
                            Code:<textarea id="codeSnippet" name="code" class="form-control"
                                           style="height: calc(30vh + 10px)">{{ snippet.code }}
                       </textarea>
                        </p>
                    </div>
                </div>
                <div class="col-1">
                    <div class="copy-button d-flex justify-content-end" onclick="copyToBuffer(`{{ snippet.code }}`)"> Copy</div>
{#                    <a class="copy-button d-flex justify-content-end" onclick="copyFromInput()" id="codeCopy">#}
{#                        Copy#}
{#                    </a>#}
                </div>
            </div>
        </fieldset>
        <div class="d-flex justify-content-end">
            <i class="text-muted">–í—Å–µ–≥–æ —Å–º–æ—Ç—Ä–µ–ª–∏: {{ snippet.views_count }}</i></div>

        {#  –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è      #}
        <div class="row mt-4">
            <div class="col-8">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5>–û—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h5>
                    </div>
                    <div class="card-body">
                        <form action="{% url 'comment_add' %}" method="POST">
                            {% csrf_token %}
                            <div class="mb-3">
                                <textarea name="text" class="form-control" id="commentText" rows="5"
                                          placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∑–¥–µ—Å—å..." required></textarea>
                            </div>
                            <div id="charCount">0/500</div>
                            <input type="hidden" name="snippet_id" value="{{ snippet.id }}">
                            <button id="buttonCom" type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <hr>
        {# –í—Å–µ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤  #}
        <div class="row">
            <div class="col-8">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="mb-0">–í—Å–µ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤: <span class="badge bg-secondary">{{ comments_count }}</span>
                    </h5>
                    {% if sort == "creation_date" %}
                        <a class="btn btn-outline-secondary btn-sm" href="?sort=-creation_date" role="button">
                            <i class="fa-solid fa-arrow-up-wide-short"></i> –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</a>
                    {% elif sort == "-creation_date" %}
                        <a class="btn btn-outline-secondary btn-sm" href="?sort=creation_date" role="button">
                            <i class="fa-solid fa-arrow-up-short-wide"></i> –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</a>
                    {% else %}
                        <a class="btn btn-outline-secondary btn-sm" href="?sort=-creation_date" role="button">
                            <i class="fa-solid fa-arrow-up-wide-short"></i> –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</a>
                    {% endif %}
                </div>
            </div>
        </div>
        {#  –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ #}
        <div class="row mt-4">
            <div class="col-8">
                <ul class="list-group mb-3">
                    {% for comment in comments %}
                        <li class="list-group-item d-flex align-items-start">
                            <div class="w-100">
                                <div class="d-flex w-100 justify-content-between">
                                    <h5 class="mb-1">{{ comment.author }}</h5>
                                    <small class="text-muted">{{ comment.creation_date|date:"j E Y    H:i" }}</small>
                                </div>
                                <p class="mb-1">
                                    {{ comment.text }}
                                </p>
                                <small>
                                    <a href="#" class="text-decoration-none me-2">–û—Ç–≤–µ—Ç–∏—Ç—å</a>
                                    <div class="d-inline-flex align-items-center me-3">
                                        <button class="btn btn-sm btn-outline-success me-1"
                                                onclick="voteComment({{ comment.id }}, 1)"
                                                title="–õ–∞–π–∫">
                                            <i class="fa-regular fa-thumbs-up"></i>
                                        </button>
                                        <span class="badge bg-success me-2" id="likes-{{ comment.id }}">{{ comment.likes_count }}</span>

                                        <button class="btn btn-sm btn-outline-danger me-1"
                                                onclick="voteComment({{ comment.id }}, -1)"
                                                title="–î–∏–∑–ª–∞–π–∫">
                                            <i class="fa-solid fa-thumbs-down"></i>
                                        </button>
                                        <span class="badge bg-danger" id="dislikes-{{ comment.id }}">{{ comment.dislikes_count }}</span>
                                    </div>
{#                                    <a href="#" class="text-decoration-none me-2">#}
{#                                        <i class="fa-regular fa-thumbs-up"></i>#}
{#                                    </a>#}
{#                                    <a href="#" class="text-decoration-none">#}
{#                                        <i class="fa-solid fa-thumbs-down"></i>#}
{#                                    </a>#}
                                </small>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>

{% endblock %}
{% block script %}
    {{ block.super }}
    <script src="{% static 'js/form_snippet.js' %}"></script>
    <script src="{% static 'js/formComment.js' %}"></script>
    <script src="{% static 'js/likeDislike.js' %}"></script>
{% endblock %}